<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="SpringMVC学习笔记 使用Spring来实现Web模块，简化Web开发 Spring为展现层提供的基于MVC设计理念的优秀的Web框架，是目前最主流的MVC框架之一 Spring3.0后全面超越Struts2，成为最优秀的MVC框架 SpringMVC通过一套MVC注解，让POJO(Plain Old Java Object&#x2F;普通的Java对象)成为处理请求的控制器，而无需实现任何">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringMVC学习笔记">
<meta property="og:url" content="http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Clover Blog">
<meta property="og:description" content="SpringMVC学习笔记 使用Spring来实现Web模块，简化Web开发 Spring为展现层提供的基于MVC设计理念的优秀的Web框架，是目前最主流的MVC框架之一 Spring3.0后全面超越Struts2，成为最优秀的MVC框架 SpringMVC通过一套MVC注解，让POJO(Plain Old Java Object&#x2F;普通的Java对象)成为处理请求的控制器，而无需实现任何">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/R-C.4008554c694ec2cc55d912974aea6dd8.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-07-29%2021.03.11.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-07-30%2011.06.59.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-08-01%2015.08.20.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/DispatcherServlet.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%86%E5%9B%BE%E5%AE%9E%E7%8E%B0%E7%B1%BB.png">
<meta property="og:image" content="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-08-15%2015.52.22.png">
<meta property="article:published_time" content="2022-01-02T10:04:00.000Z">
<meta property="article:modified_time" content="2023-05-26T09:45:32.852Z">
<meta property="article:author" content="Clover You">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="SpringMvc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qiniu-note-image.ctong.top/note/images/R-C.4008554c694ec2cc55d912974aea6dd8.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SpringMVC学习笔记</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Clover Blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/01/02/Spring-Boot%E5%9F%BA%E7%A1%80---%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/01/02/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&text=SpringMVC学习笔记"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&is_video=false&description=SpringMVC学习笔记"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpringMVC学习笔记&body=Check out this article: http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&name=SpringMVC学习笔记&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&t=SpringMVC学习笔记"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">SpringMVC学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">导包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HelloWorld"><span class="toc-number">1.3.</span> <span class="toc-text">HelloWorld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">编写处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91"><span class="toc-number">1.3.2.</span> <span class="toc-text">转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">视图解析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestMapping"><span class="toc-number">1.4.</span> <span class="toc-text">@RequestMapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E6%B3%A8%E5%9C%A8%E7%B1%BB%E4%B8%8A"><span class="toc-number">1.4.1.</span> <span class="toc-text">标注在类上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">规定请求方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.3.</span> <span class="toc-text">规定请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">1.4.4.</span> <span class="toc-text">规定请求头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ant%E9%A3%8E%E6%A0%BC%E7%9A%84URL"><span class="toc-number">1.4.5.</span> <span class="toc-text">Ant风格的URL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PathVariable"><span class="toc-number">1.5.</span> <span class="toc-text">@PathVariable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REST"><span class="toc-number">1.6.</span> <span class="toc-text">REST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestParam"><span class="toc-number">1.7.1.</span> <span class="toc-text">@RequestParam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestHeader"><span class="toc-number">1.7.2.</span> <span class="toc-text">@RequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CookieValue"><span class="toc-number">1.7.3.</span> <span class="toc-text">@CookieValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJO%E5%8F%82%E6%95%B0"><span class="toc-number">1.7.4.</span> <span class="toc-text">POJO参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%94%9FAPI"><span class="toc-number">1.7.5.</span> <span class="toc-text">原生API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="toc-number">1.8.</span> <span class="toc-text">SpringMVC解决中文乱码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="toc-number">1.9.</span> <span class="toc-text">数据输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Map"><span class="toc-number">1.9.1.</span> <span class="toc-text">Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model"><span class="toc-number">1.9.2.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelMap"><span class="toc-number">1.9.3.</span> <span class="toc-text">ModelMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelAndView"><span class="toc-number">1.9.4.</span> <span class="toc-text">ModelAndView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionAttributes"><span class="toc-number">1.9.5.</span> <span class="toc-text">@SessionAttributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelAttribute"><span class="toc-number">1.9.6.</span> <span class="toc-text">@ModelAttribute</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DispatcherServlet-%E5%88%86%E6%9E%90"><span class="toc-number">1.10.</span> <span class="toc-text">DispatcherServlet 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%9B%BE"><span class="toc-number">1.10.1.</span> <span class="toc-text">继承图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%A7%E8%87%B4%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.10.2.</span> <span class="toc-text">请求大致处理流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringMVC%E4%B9%9D%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">1.10.3.</span> <span class="toc-text">SpringMVC九大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.10.4.</span> <span class="toc-text">执行目标方法源码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text">视图和视图解析器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8-1"><span class="toc-number">1.11.1.</span> <span class="toc-text">视图解析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.11.2.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91-1"><span class="toc-number">1.11.3.</span> <span class="toc-text">转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.11.4.</span> <span class="toc-text">重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.5.</span> <span class="toc-text">视图解析流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E5%92%8C%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.11.6.</span> <span class="toc-text">自定义视图和视图解析器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">1.12.</span> <span class="toc-text">数据绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.12.1.</span> <span class="toc-text">自定义类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">数据格式化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0Converter"><span class="toc-number">1.12.2.</span> <span class="toc-text">实现Converter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Emvc-annotation-driven"><span class="toc-number">1.13.</span> <span class="toc-text">关于mvc:annotation-driven</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.13.1.</span> <span class="toc-text">静态资源无法访问原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.14.</span> <span class="toc-text">数据校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hibernate-validator"><span class="toc-number">1.14.1.</span> <span class="toc-text">hibernate-validator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E5%93%8D%E5%BA%94JSON"><span class="toc-number">1.15.</span> <span class="toc-text">SpringMVC响应JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonFormat"><span class="toc-number">1.15.1.</span> <span class="toc-text">JsonFormat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResponseBody"><span class="toc-number">1.16.</span> <span class="toc-text">ResponseBody</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestBody"><span class="toc-number">1.17.</span> <span class="toc-text">RequestBody</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpEntity"><span class="toc-number">1.18.</span> <span class="toc-text">HttpEntity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResponseEntity"><span class="toc-number">1.19.</span> <span class="toc-text">ResponseEntity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.20.</span> <span class="toc-text">SpringMVC文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.21.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.21.1.</span> <span class="toc-text">多文件上传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpMessageConverter-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">1.22.</span> <span class="toc-text">HttpMessageConverter(内容协商)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.23.</span> <span class="toc-text">拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.23.1.</span> <span class="toc-text">自定义拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.24.</span> <span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ExceptionHandler"><span class="toc-number">1.24.1.</span> <span class="toc-text">@ExceptionHandler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ControllerAdvice%E5%85%A8%E5%B1%80%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">1.24.2.</span> <span class="toc-text">@ControllerAdvice全局处理异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseStatus"><span class="toc-number">1.24.3.</span> <span class="toc-text">@ResponseStatus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleMappingExceptionHandle"><span class="toc-number">1.24.4.</span> <span class="toc-text">SimpleMappingExceptionHandle</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.25.</span> <span class="toc-text">SpringMVC运行流程</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        SpringMVC学习笔记
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Clover You</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-01-02T10:04:00.000Z" class="dt-published" itemprop="datePublished">2022-01-02</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Spring/">Spring</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/JAVA/" rel="tag">JAVA</a>, <a class="p-category" href="/tags/Spring/" rel="tag">Spring</a>, <a class="p-category" href="/tags/SpringMvc/" rel="tag">SpringMvc</a>, <a class="p-category" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="SpringMVC学习笔记"><a href="#SpringMVC学习笔记" class="headerlink" title="SpringMVC学习笔记"></a>SpringMVC学习笔记</h1><ul>
<li>使用Spring来实现Web模块，简化Web开发</li>
<li>Spring为展现层提供的基于MVC设计理念的优秀的Web框架，是目前最主流的MVC框架之一</li>
<li>Spring3.0后全面超越Struts2，成为最优秀的MVC框架</li>
<li>SpringMVC通过一套MVC注解，让POJO(Plain Old Java Object&#x2F;普通的Java对象)成为处理请求的控制器，而无需实现任何接口</li>
<li>支持REST风格的URL请求</li>
<li>采用了松散耦合可插拔组件结构，比其他MVC框架更具扩展性和灵活性</li>
</ul>
<p><img src="http://qiniu-note-image.ctong.top/note/images/R-C.4008554c694ec2cc55d912974aea6dd8.png" alt="MVC流程图"></p>
<h2 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h2><ul>
<li><p>SpringMVC是Spring的Web模块。所有模块的运行都是依赖核心模块（IOC）</p>
<ol>
<li><p>核心容器模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">commons-logging-1.1.3.jar</span><br><span class="line">spring-aop-4.0.0.RELEASE.jar</span><br><span class="line">spring-beans-4.0.0.RELEASE.jar</span><br><span class="line">spring-context-4.0.0.RELEASE.jar</span><br><span class="line">spring-core-4.0.0.RELEASE.jar</span><br><span class="line">spring-expression-4.0.0.RELEASE.jar</span><br></pre></td></tr></table></figure>


</li>
<li><p>Web模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring-web-4.0.0.RELEASE.jar</span><br><span class="line">spring-webmvc-4.0.0.RELEASE.jar</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>SpringMVC思想是有一个前端控制器能拦截所有请求并智能派发。这个前端控制器是一个<strong>Servlet</strong>。所以它应该在web.xml中配置这个servlet拦截所有请求。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置SpringMVC DispatcherServlet --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--   contextConfigLocation: 指定配置文件路径     --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /*和/都是拦截所有请求。但/*的范围更大，还会拦截*.jsp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h2><p>创建一个MVC项目</p>
<h3 id="编写处理器"><a href="#编写处理器" class="headerlink" title="编写处理器"></a>编写处理器</h3><p>新建一个类<code>top.ctong.controller.MyFirstController</code>，需要使用注解的方式告诉Spring这个是一个处理器，可以处理请求。</p>
<p>可以使用注解的方式，这需要<code>context</code>名称空间和进行包扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFirstController</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>在SpringMVC中，<code>@Controller</code>不能随便加，它会被区分为处理器。当然，你也不能使用其它注解代替<code>@Controller</code>注解。</p>
<p>接下在写一个方法来处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myFirstRequest</span><span class="params">()</span> &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Hello World！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>昨晚这些后还不够，你还要告诉SpringMVC你这个方法处理哪个请求，这时可以使用<code>@RequestMapping</code>。这个注解有一个<code>value</code>属性，这个属性用来指定你需要处理的路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myFirstRequest</span><span class="params">()</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>用浏览器发送这个请求后后端得到打印结果<code>localhost:[your port]/hello</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World！</span><br></pre></td></tr></table></figure>



<h3 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h3><p>你的方法直接返回一个字符串，SpringMVC会自动进行转发，Servlet会根据这个路径尝试去资源中找对应的资源。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转发到欢迎页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> /welcome.jsp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/welcome&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">welcomePage</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;/WEB-INF/pages/welcome.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-07-29%2021.03.11.png" alt="welcome页转发结果"></p>
<h3 id="视图解析器"><a href="#视图解析器" class="headerlink" title="视图解析器"></a>视图解析器</h3><p>如果我们要转发视图，需要返回视图的具体路径，但我们页面都是在同一个目录下<code>/WEB-INF/pages</code>。可以让视图解析器自动帮我们加上，而且页面都是<code>jsp</code>，也可以通过视图解析器配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  配置视图解析器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springf ramework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--  前缀  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--  后缀  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转发到欢迎页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> /welcome.jsp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/welcome&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">welcomePage</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ol>
<li>客户端发送请求</li>
<li>来到tomcat服务器</li>
<li>SpringMVC的前端控制器收到所有请求</li>
<li>来看请求地址和<code>@RequestMapping</code>标注的哪个匹配，来找到使用哪个类的哪个方法</li>
<li>前端控制器找到了目标处理器和目标方法，直接利用反射执行目标方法</li>
<li>方法执行完成之后会有一个返回值，SpringMVC认为这个返回值就是要去的页面地址</li>
<li>拿到方法返回值以后，用视图解析器进行拼接字符串得到完整的页面地址</li>
<li>拿到页面地址，前端控制器帮我们转发到页面</li>
</ol>
<h2 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h2><p><code>@RequestMapping</code>注解其实就是告诉SpringMVC这个方法用来处理什么请求。在控制器的类定义及方法定义处都可标注</p>
<ul>
<li>类定义处<br>提供初步的请求映射信息，相对于WEB应用的根目录</li>
<li>方法处<br>提供进一步的细分映射信息，相对于类定义处的URL，若类定义处未标注<code>@RequestMapping</code>，则方法处标记的URL相对于WEB应用的根目录</li>
</ul>
<blockquote>
<p><code>DispatcherServlet</code>截获请求后，就通过控制器上的<code>@RequestMapping</code>提供的映射信息确定请求所对应的处理方法。</p>
</blockquote>
<h3 id="标注在类上"><a href="#标注在类上" class="headerlink" title="标注在类上"></a>标注在类上</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request_mapping&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestMappingTestController</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 测试RequestMapping</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> welcome.jsp</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testRequestMapping输出了···&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-07-30%2011.06.59.png" alt="标注在类上的RequestMapping测试结果"></p>
<h3 id="规定请求方式"><a href="#规定请求方式" class="headerlink" title="规定请求方式"></a>规定请求方式</h3><p><code>@RequestMapping</code>默认可以处理所有方式的请求，若需要限定请求方式，可以通过<code>method</code>属性指定。</p>
<p>它支持这么多种请求方式<code>GET</code> <code>HEAD</code> <code>POST</code> <code>PUT</code> <code>PATCH</code> <code>DELETE</code> <code>OPTIONS</code> <code>TRACE</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试RequestMapping的method属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/testRequestMappingMethod&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMappingMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时发送GET请求时，发生405错误</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;rquest_mapping_api&#125;&#125;/test_request_mapping_method</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">405</span> Method Not Allowed</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Allow</span><span class="punctuation">: </span>POST</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=utf-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>689</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:18:44 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<p>使用对应请求方式请求通过</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;rquest_mapping_api&#125;&#125;/test_request_mapping_method</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>JSESSIONID=FD4CF51D92D3A2105958A5AE4DC6DF54; Path=/SpringMvcHelloWorld_war_exploded; HttpOnly</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1222</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:21:09 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>





<h3 id="规定请求参数"><a href="#规定请求参数" class="headerlink" title="规定请求参数"></a>规定请求参数</h3><p>在<code>@RequestMapping</code>中，有个<code>params</code>参数，它用于规定请求中必须存在指定参数。它还支持简单表达式</p>
<ul>
<li><code>param1</code>表示请求必须包含名为<code>param1</code>的参数</li>
<li><code>!param1</code>表示请求必须不携带<code>param1</code>参数</li>
<li><code>param1=xxx</code>表示请求必须包含<code>param1</code>参数，并且值为<code>xxx</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试RequestMapping的method属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/test_request_mapping_params&quot;, method = RequestMethod.POST,</span></span><br><span class="line"><span class="meta">                params = &#123;&quot;userName&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMappingParam</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果当前请求没有携带指定参数，那么返回响应404</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;rquest</span> _mapping_api&#125;&#125;/test_request_mapping_params <span class="string">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">404</span> Not Found</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=utf-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>649</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:34:58 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<p>携带参数后正常访问</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;rquest_mapping_api&#125;&#125;/test_request_mapping_params?userName=CLOVER</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1222</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:38:43 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<p>使用<code>非</code>表达式后，这个请求直接404</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">404</span> Not Found</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=utf-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>649</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:42:16 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>



<h3 id="规定请求头"><a href="#规定请求头" class="headerlink" title="规定请求头"></a>规定请求头</h3><p>根据你的规则定制请求头参数，如果不满足你的规则，那么返回404。用法与<a href="###%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">规定请求参数</a>一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 规定请求头</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/test_request_mapping_headers&quot;, headers = &#123;&quot;author&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMappingHeaders</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;rquest_mapping_api&#125;&#125;/test_request_mapping_headers</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">author</span><span class="punctuation">: </span>clover</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1222</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 04:59:04 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>



<h3 id="Ant风格的URL"><a href="#Ant风格的URL" class="headerlink" title="Ant风格的URL"></a>Ant风格的URL</h3><p>Ant风格资源地址支持3中匹配符</p>
<ul>
<li><code>?</code> 匹配文件名中的一个字符</li>
<li><code>*</code> 匹配文件名中的任意字符</li>
<li><code>**</code> 匹配多层路径</li>
</ul>
<p><code>@RequestMapping</code>还支持Ant风格的URL</p>
<ul>
<li><code>/user/*/createUser</code>匹配<code>/user/aaa/createUser</code>、<code>/user/bbb/createUser</code>等URL</li>
<li><code>/user/**/createUser</code>匹配<code>/user/createUser</code>、<code>/user/aaa/bbb/createUser</code>等URL</li>
<li><code>/user/createUser??</code>匹配<code>/user/createUseraaa</code>、<code>/user/createUser/bb</code>等URL</li>
</ul>
<h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h2><ul>
<li>带占位符的URL是Spring3.0新增的功能，该功能在SpringMVC向REST目标挺进发中过程中具有里程碑的意义</li>
<li>通过<code>@PathVariable</code>可以将URL中占位符参数绑定到控制器处理方法的入参中。URL中的<code>&#123;xxx&#125;</code>占位符可以通过<code>@PathVariable(“xxx”)</code>绑定到操作方法的入参中。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPathVariable</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id=&quot;</span>+id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;path_variable&#125;&#125;/delete/2020-13</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 05:49:34 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">id</span><span class="operator">=</span><span class="number">2020</span>-<span class="number">13</span></span></span><br></pre></td></tr></table></figure>

<p><em>路径上的占位符只能占一层路径</em></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/&#123;&#123;path_variable&#125;&#125;/delete/hia/2020-13</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">404</span> Not Found</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=utf-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>649</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 05:56:05 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>



<h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><ul>
<li>REST 即Representational State Transfer。（资源）表现层状态转化。<strong>是目前最流行的一种互联网软件架构。</strong>它结构清晰、符合标准、易于理解、扩展方便，所以才能得到越来越多网站的采用</li>
<li>资源（Resources）网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌、一种服务，总之就是一个具体的存在。可以用一个URL（统一资源定位符）指向它，每种资源对应一个特定的URL。需要获取这个资源，访问它的URL就可以。因此URL即为每一个资源独一无二的识别符。</li>
<li>表现层（Representational）把具体资源呈现出来的形式，叫做它的表现层。比如，文本可以用txt格式表现，也可以用HTML格式、XML格式、JSON格式表现，甚至可以采用二进制格式</li>
<li>状态转化（State Transfer）每发出一个请求，就代表客户端和服务器的一次交互过程。HTTp协议，是一个无状态协议，即所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转化”。而这种转化是建立在表现层之上的。所以就是“表现层状态转化”。具体说就是<strong>HTTP协议里面，四哥表示操作方式的动词：GET、POST、PUT、DELETE。他们分别对应四种基本操作：GET用来获取资源，POST用来新建资源，PUT用来更新资源，DELETE用来删除资源。</strong></li>
</ul>
<blockquote>
<p>REST风格URL：<code>/资源名/资源标识符</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/rest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestStyleController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user/&#123;userId&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;get user: &quot;</span> + userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user/&#123;userId&#125;&quot;, method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update user: &quot;</span> + userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user/&#123;userName&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser</span><span class="params">(<span class="meta">@PathVariable</span> String userName, String pass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;add user: &quot;</span> + userName + <span class="string">&quot;; pass: &quot;</span> + pass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user/&#123;userName&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> String userName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete user: &quot;</span> + userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GET方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/rest/user/8848</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>14</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 06:37:58 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="keyword">get</span> <span class="keyword">user</span>: <span class="number">8848</span></span></span><br></pre></td></tr></table></figure>



<p>POST方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">&#123;&#123;url&#125;&#125;/rest/user/clover?pass=123</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>25</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 06:38:38 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-llvm"><span class="keyword">add</span> user: clover<span class="comment">; pass: 123</span></span></span><br></pre></td></tr></table></figure>



<p>PUT方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">&#123;&#123;url&#125;&#125;/rest/user/8848</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>17</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 06:38:49 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-n1ql"><span class="keyword">update</span> <span class="keyword">user</span>: <span class="number">8848</span></span></span><br></pre></td></tr></table></figure>



<p>DELETE方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="string">&#123;&#123;url&#125;&#125;/rest/user/8848</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache-Coyote/1.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>17</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 31 Jul 2021 06:39:11 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-n1ql"><span class="keyword">delete</span> <span class="keyword">user</span>: <span class="number">8848</span></span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>高版本tomcat（8.0+）jsp页面只允许GTE、POST、HEAD请求访问</p>
</blockquote>
<h2 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h2><p>由于每一种请求方式、请求类型的不同，需要从不同的地方获取参数，此时可以使用SpringMVC提供的几个注解从指定位置获取参数。</p>
<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h3><p>默认方式获取请求参数，可以在方法上写一个和请求参数名相同的变量，SpringMVC会根据这个变量的变量名获取到对应的请求参数，<strong>如果获取不到这个参数值，那么默认null。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/not_request_param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">noRequestParam</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;userName=&quot;</span>+userName);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/param/not_request_param?userName=Clover</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userName=Clover</span><br></pre></td></tr></table></figure>

<p>通过<code>@RequestParam</code>注解，可以指定获取请求参数的值。如果不指定<code>value</code>那么默认<code>value</code>就是被标注的参数的参数名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/request_param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam</span><span class="params">(<span class="meta">@RequestParam(&quot;userName&quot;)</span> String userName)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;userName=&quot;</span> + userName);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/param/request_param?userName=Clover</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userName=Clover</span><br></pre></td></tr></table></figure>

<p>如果指定参数不存在，那么会出现400的请求错误，被当前注解标注的参数，表示该参数是必须的。可以通过<code>required</code>属性声明当前参数并不是必须的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam</span><span class="params">(<span class="meta">@RequestParam(value = &quot;...&quot;, required = false)</span> ...)</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>当<code>required</code>属性为<code>false</code>时，可以通过<code>defaultValue</code>来为当前变量设置一个默认值。如果请求没有携带指定参数，那么就会使用<code>defaultValue</code>中定义的值作为参数值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam</span><span class="params">(<span class="meta">@RequestParam(value = &quot;...&quot;, required = false, defaultValue = &quot;Clover&quot;)</span> ...)</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>





<h3 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h3><p>用于获取请求头中的某个key</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RequestHeader的使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request_header&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;author&quot;)</span> String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;author=&quot;</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/param/request_header</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">author</span><span class="punctuation">: </span>Clover</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">author=Clover</span><br></pre></td></tr></table></figure>

<p>用法与<code>@RequestParam</code>一致</p>
<h3 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a>@CookieValue</h3><p>获取指定cookie值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RequestHeader的使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/cookie_value&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">cookieValue</span><span class="params">(<span class="meta">@CookieValue(&quot;cookieName&quot;)</span> String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cookieName=&quot;</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/param/cookie_value</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>cookieName=&quot;Clover cookie&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookieName=Clover cookie</span><br></pre></td></tr></table></figure>

<p>用法与<code>@RequestParam</code>一致</p>
<h3 id="POJO参数"><a href="#POJO参数" class="headerlink" title="POJO参数"></a>POJO参数</h3><p>如果我们的请求参数是一个POJO，那么SpringMVC会自动为这个POJO赋值</p>
<ul>
<li>将POJO中的每一个属性，从request中获取出来并封装。</li>
<li>支持集联封装</li>
<li>请求参数的参数名要和对象中的属性名一一对应</li>
</ul>
<p>pojo类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 书籍名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 价格</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Short stock;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Short sales;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 省</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 市</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 街道</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/pojo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">usePOJO</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    System.out.println(book);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">&#123;&#123;url&#125;&#125;/param/pojo</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-dts">bookN<span class="attr">ame</span><span class="operator">=</span>SpringMVC<span class="variable">&amp;author</span>=Clover<span class="variable">&amp;price</span>=<span class="number">9.99</span><span class="variable">&amp;stock</span>=<span class="number">2048</span><span class="variable">&amp;sales</span>=<span class="number">1024</span><span class="variable">&amp;address</span>.<span class="attr">province</span><span class="operator">=</span>广东省<span class="variable">&amp;address</span>.<span class="attr">city</span><span class="operator">=</span>广州市<span class="variable">&amp;address</span>.<span class="attr">street</span><span class="operator">=</span>xxx街道</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;bookName&quot;:&quot;SpringMVC&quot;,&quot;author&quot;:&quot;Clover&quot;,&quot;price&quot;:9.99,&quot;stock&quot;:2048,&quot;sales&quot;:1024,&quot;address&quot;:&#123;&quot;province&quot;:&quot;广东省&quot;,&quot;city&quot;:&quot;广州市&quot;,&quot;street&quot;:&quot;xxx街道&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="原生API"><a href="#原生API" class="headerlink" title="原生API"></a>原生API</h3><p>SpringMVC支持原生API参数例如：<code>HttpServletRequest</code>、<code>HttpSession</code>等…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/primitiveAPI&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">primitiveAPI</span><span class="params">(HttpSession session, HttpServletRequest request)</span> &#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;session&quot;</span>,<span class="string">&quot;hi!&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;req&quot;</span>, <span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/param/primitiveAPI</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;Welcome~~~&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;Request: $&#123;requestScope.req&#125;&lt;/h1&gt;&lt;br/&gt;</span><br><span class="line">  &lt;h1&gt;Session: $&#123;sessionScope.session&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-08-01%2015.08.20.png" alt="原生API写入结果"></p>
<p>原生API也只能传个别的，并不是全部都能传：</p>
<ul>
<li><code>HttpServletRequest</code></li>
<li><code>HttpServletResponse</code></li>
<li><code>HttpSession</code></li>
<li><code>java.security.Principal</code></li>
<li><code>Locale</code></li>
<li><code>InputStream</code></li>
<li><code>OutputStream</code></li>
<li><code>Reader</code></li>
<li><code>Writer</code></li>
</ul>
<h2 id="SpringMVC解决中文乱码"><a href="#SpringMVC解决中文乱码" class="headerlink" title="SpringMVC解决中文乱码"></a>SpringMVC解决中文乱码</h2><p>如果遇到<code>POST</code>中文乱码问题，可以使用SpringMVC中提供的<code>org.springframework.web.filter.CharacterEncodingFilter</code>过滤器。过滤字符编码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置SpringMVC提供的字符编码过滤器 设置字符编码 解决中文乱码问题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    解决请求乱码    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    解决响应乱码    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="数据输出"><a href="#数据输出" class="headerlink" title="数据输出"></a>数据输出</h2><p>SpringMVC除了在方法上传入原生的request和session外，还能在方法上传入Map、Model、或者ModelMap。给这些参数里面保存的所有数据都会被放在请求域中。可以通过JSP页面获取</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/byMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">byMap</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">    map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;使用了Map&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;output/displayData&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Map会被放在request域对象中</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;pageContext域对象: $&#123;pageContext.msg&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/byModel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">byModel</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;使用了Model&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;output/displayData&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Model会被放在request域中</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;request域对象: $&#123;requestScope.msg&#125;&lt;/h1&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="ModelMap"><a href="#ModelMap" class="headerlink" title="ModelMap"></a>ModelMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/byModelMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">byModel</span><span class="params">(ModelMap model)</span> &#123;</span><br><span class="line">    model.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;使用了ModelMap&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;output/displayData&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样会放在域对象</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;request域对象: $&#123;requestScope.msg&#125;&lt;/h1&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a>ModelAndView</h3><p>除了使用以上三种类型作为方法参数外，还可以将方法返回值设置为<code>ModelAndView</code>。它既包含视图信息也包含模型数据。而且数据是放在请求域中的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/byModelAndView&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">byModelAndView</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;output/displayData&quot;</span>);</span><br><span class="line">    mv.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;byModelAndView&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;request域对象: $&#123;requestScope.msg&#125;&lt;/h1&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h3><p>给BindingAwareModelMap中保存的数据，或者ModelAndView中保存的数据，同时也给session中保存一份。</p>
<p>它只能写在类上，并且它有两个属性</p>
<ol>
<li><code>value</code> 保存数据时要给session中放的数据的key</li>
<li><code>types</code> 保存数据时，如果这个数据的类型与<code>types</code>中的类型一致才保存。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SessionAttributes(&quot;msg&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/output&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutputDataController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/byMap&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">byMap</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;使用了Map&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;output/displayData&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;request域对象: $&#123;requestScope.msg&#125;&lt;/h1&gt;&lt;br/&gt;</span><br><span class="line">&lt;h1&gt;session域对象: $&#123;sessionScope.msg&#125;&lt;/h1&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h3><p>这个注解可以标注在两处位置：方法上、方法参数上</p>
<ul>
<li>参数：取出model中保存的数据</li>
<li>方法上：每次有请求过来时，被标注的方法都会先于目标方法运行。在此可以保存一些必要信息到request域对象中。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟查询数据库数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectUser</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setAge(<span class="number">19</span>);</span><br><span class="line">    user.setSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;Clover&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/byModelAttribute&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">byModelAttribute</span><span class="params">(<span class="meta">@ModelAttribute(&quot;user&quot;)</span> User user)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user ==========&gt;&gt;&gt;&gt;&gt; &quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;output/displayData&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user ==========&gt;&gt;&gt;&gt;&gt; &#123;&quot;name&quot;:&quot;Clover&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:19&#125;</span><br></pre></td></tr></table></figure>

<p><code>@ModelAttribute</code>还有一个功能，就是，如果前端传了这个参数，那么就使用前端的参数将对应属性进行覆盖。</p>
<p>例如这个请求，我传了一个<code>name</code>参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx/output/byModelAttribute?name=Ali总裁</span><br></pre></td></tr></table></figure>

<p>后台打印结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user ==========&gt;&gt;&gt;&gt;&gt; &#123;&quot;name&quot;:&quot;Ali总裁&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:19&#125;</span><br></pre></td></tr></table></figure>



<h2 id="DispatcherServlet-分析"><a href="#DispatcherServlet-分析" class="headerlink" title="DispatcherServlet 分析"></a>DispatcherServlet 分析</h2><h3 id="继承图"><a href="#继承图" class="headerlink" title="继承图"></a>继承图</h3><p><img src="http://qiniu-note-image.ctong.top/note/images/DispatcherServlet.png" alt="DispatcherServlet继承图"></p>
<h3 id="请求大致处理流程"><a href="#请求大致处理流程" class="headerlink" title="请求大致处理流程"></a>请求大致处理流程</h3><p>发送请求时，这个请求会被<code>org.springframework.web.servlet.DispatcherServlet#doDispatch</code>方法处理。</p>
<ul>
<li><p>检查当前请求是否为文件上传请求，如果是文件上传请求，重新包装<code>request</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">processedRequest = checkMultipart(request);</span><br><span class="line">multipartRequestParsed = processedRequest != request;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据请求地址到所有Controller中找，看哪个Controller能处理当前请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Determine handler for the current request.</span></span><br><span class="line">mappedHandler = getHandler(processedRequest);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>handlerMappings</code>保存了所有的handler映射信息。在ioc容器创建Controller对象的时候，扫描每个处理器都能处理什么请求，然后将其保存在HandlerMapping的handlerMap中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (HandlerMapping hm : <span class="built_in">this</span>.handlerMappings) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查当前handler是否支持处理这个<code>request</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> hm.getHandler(request);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果支持处理当前请求那么就将匹配到的handler直接返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>如果没有找到或者说没有handler能处理这个请求，那么就抛出异常或者转发到404页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mappedHandler == <span class="literal">null</span> || mappedHandler.getHandler() == <span class="literal">null</span>) &#123;</span><br><span class="line">   noHandlerFound(processedRequest, response);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>拿到这个handler的适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line"><span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>

<ul>
<li><p>循环便利所有的<code>handlerAdapters</code>，默认情况下只有三个adapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (HandlerAdapter ha : <span class="built_in">this</span>.handlerAdapters)&#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过调用每个Adapter的<code>supports</code>方法确定当前adpter是否支持处理这个<strong>handler</strong></p>
</li>
</ul>
</li>
<li><p>适配器执行目标方法。将目标方法执行完成后的返回结果作为视图名，设置保存到<code>ModelAndView</code>中。目标方法无论怎么写，最终适配器执行完成后都会将执行结果封装成<code>ModelAndView</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Actually invoke the handler.</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据方法最终执行完成后封装的ModelAndView转发到对应页面，并且ModelAndView中的数据可以从请求域中获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="SpringMVC九大组件"><a href="#SpringMVC九大组件" class="headerlink" title="SpringMVC九大组件"></a>SpringMVC九大组件</h3><p><code>org.springframework.web.servlet.DispatcherServlet</code>中有九大组件。SpringMVC在工作的时候都是由这些组件来完成。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 文件上传解析器 */</span></span><br><span class="line"><span class="keyword">private</span> MultipartResolver multipartResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 区域信息解析器「国际化」 */</span></span><br><span class="line"><span class="keyword">private</span> LocaleResolver localeResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 主题解析器 */</span></span><br><span class="line"><span class="keyword">private</span> ThemeResolver themeResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** List of HandlerMappings used by this servlet */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerMapping&gt; handlerMappings;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** handler适配器 */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerAdapter&gt; handlerAdapters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** SpringMVC强大的异常解析器 */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerExceptionResolver&gt; handlerExceptionResolvers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** RequestToViewNameTranslator used by this servlet */</span></span><br><span class="line"><span class="keyword">private</span> RequestToViewNameTranslator viewNameTranslator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** SpringMVC中允许重定向携带数据的功能*/</span></span><br><span class="line"><span class="keyword">private</span> FlashMapManager flashMapManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 视图解析器 */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;ViewResolver&gt; viewResolvers</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p>他们都有一个共同点：他们都是接口</p>
<blockquote>
<p>接口就是规范</p>
</blockquote>
<p>SpringMVC九大组件在<code>org.springframework.web.servlet.DispatcherServlet#onRefresh</code>方法中进行初始化。在初始化过程中，全部组件都是从ioc容器中获取，但如果ioc容器中没有这个组件，就使用默认策略。这个默认策略都在<code>spring-webmvc-4.0.0.RELEASE.jar!/org/springframework/web/servlet/DispatcherServlet.properties</code>文件中定义好了</p>
<h3 id="执行目标方法源码分析"><a href="#执行目标方法源码分析" class="headerlink" title="执行目标方法源码分析"></a>执行目标方法源码分析</h3><p>目标方法<code>org.springframework.web.servlet.DispatcherServlet#doDispatch</code>。</p>
<ul>
<li><p>跳过其它，<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查当前这个类(controller)是否已经被缓存在<code>org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter#sessionAnnotatedClassesCache</code>中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Boolean</span> <span class="variable">annotatedWithSessionAttributes</span> <span class="operator">=</span> <span class="built_in">this</span>.sessionAnnotatedClassesCache.get(clazz);</span><br></pre></td></tr></table></figure>


</li>
<li><p>如果这个类的指定注解状态没有被缓存，那么就去检查这个类是否存在这个注解<code>@SessionAttributes</code>。最后将检查结果缓存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (annotatedWithSessionAttributes == <span class="literal">null</span>) &#123;</span><br><span class="line">  annotatedWithSessionAttributes = (AnnotationUtils.findAnnotation(clazz, SessionAttributes.class) != <span class="literal">null</span>);</span><br><span class="line">  <span class="built_in">this</span>.sessionAnnotatedClassesCache.put(clazz, annotatedWithSessionAttributes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它代码不管，直接跳到最后一行，<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> invokeHandlerMethod(request, response, handler);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取方法解析器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletHandlerMethodResolver</span> <span class="variable">methodResolver</span> <span class="operator">=</span> getMethodResolver(handler);</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据解析器解析当前请求，检查哪个方法能够处理处理当前请求，最后拿到一个<code>Method</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> methodResolver.resolveHandlerMethod(request);</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据方法解析器创建一个方法执行器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletHandlerMethodInvoker</span> <span class="variable">methodInvoker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletHandlerMethodInvoker</span>(methodResolver);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个<code>org.springframework.validation.support.BindingAwareModelMap</code>，之前使用<code>ModelAttribute</code>获取的什么Map、Model、ModelMap就是使用的是它。貌似它<strong>非常重要、非常重要、非常重要</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExtendedModelMap</span> <span class="variable">implicitModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BindingAwareModelMap</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行目标方法，利用反射执行期间确定参数值、提前执行<code>ModelAttribute</code>等所有操作都在这个方法中完成  <strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> methodInvoker.invokeHandlerMethod(handlerMethod, handler, webRequest, implicitModel);</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查调用的方法是否为桥接方法，如果是，那么尽可能找到原方法(不清楚是不是这个逻辑)。<a target="_blank" rel="noopener" href="https://www.cnblogs.com/heihaozi/p/14142671.html">可以到这里了解桥接方法是什么</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">handlerMethodToInvoke</span> <span class="operator">=</span> BridgeMethodResolver.findBridgedMethod(handlerMethod);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取SessionAttribute指定的名字。如果有，那么将它的值保存到<code>implicitModel</code>。看到这这貌似是一个域对象？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (String attrName : <span class="built_in">this</span>.methodResolver.getActualSessionAttributeNames()) &#123;</span><br><span class="line">   <span class="type">Object</span> <span class="variable">attrValue</span> <span class="operator">=</span> <span class="built_in">this</span>.sessionAttributeStore.retrieveAttribute(webRequest, attrName);</span><br><span class="line">   <span class="keyword">if</span> (attrValue != <span class="literal">null</span>) &#123;</span><br><span class="line">      implicitModel.addAttribute(attrName, attrValue);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取这个controller中是否存在被<code>@ModelAttribute</code>标注的类，并循环它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Method attributeMethod : <span class="built_in">this</span>.methodResolver.getModelAttributeMethods()) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>获取到这个被标注的方法<code>@ModelAttribute</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">attributeMethodToInvoke</span> <span class="operator">=</span> BridgeMethodResolver.findBridgedMethod(attributeMethod);</span><br></pre></td></tr></table></figure>
</li>
<li><p>确定方法执行是所需要的所有参数的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object[] args = resolveHandlerArguments(attributeMethodToInvoke, handler, webRequest, implicitModel);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取当前方法中<code>@ModelAttribute</code>的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> AnnotationUtils.findAnnotation(attributeMethod, ModelAttribute.class).value();</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过<code>@ModelAttribute</code>的值判断如果当前域对象中存在这个属性，那么就跳出当前循环。在这里证明了，被<code>@ModelAttribute</code>标注的方法无法覆盖域对象中存在的属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(attrName) &amp;&amp; implicitModel.containsAttribute(attrName)) &#123;</span><br><span class="line">	<span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始执行这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">attrValue</span> <span class="operator">=</span> attributeMethodToInvoke.invoke(handler, args);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果<code>@ModelAttribute</code>注解没有制定value，那么就使用返回值类型名称的小驼峰作为value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(attrName)) &#123;</span><br><span class="line">   Class&lt;?&gt; resolvedType = GenericTypeResolver.resolveReturnType(attributeMethodToInvoke, handler.getClass());</span><br><span class="line">   attrName = Conventions.getVariableNameForReturnType(attributeMethodToInvoke, resolvedType, attrValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后把目标方法的返回值添加到<code>BindingAwareModelMap</code>中，以attrName作为key。到此<code>ModelAttribute</code>执行结束</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!implicitModel.containsAttribute(attrName)) &#123;</span><br><span class="line">   implicitModel.addAttribute(attrName, attrValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>确定目标方法执行时所需要的参数值 <strong>Step Into</strong>进去看看怎么为POJO赋值的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object[] args = resolveHandlerArguments(handlerMethodToInvoke, handler, webRequest, implicitModel);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>获取到所有参数。并且创建一个<code>Object[]</code>，用于接收对应的参数值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt;[] paramTypes = handlerMethod.getParameterTypes();</span><br><span class="line">Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[paramTypes.length];</span><br></pre></td></tr></table></figure>
</li>
<li><p>循环处理所有参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取到当前参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MethodParameter</span> <span class="variable">methodParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodParameter</span>(handlerMethod, i);</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化<code>parameterNameDiscoverer</code>，为了后面获取参数名，这是Spring提供的工具</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">methodParam.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它不认识，跳过…</p>
</li>
<li><p>获取到参数中所有的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Annotation[] paramAnns = methodParam.getParameterAnnotations();</span><br></pre></td></tr></table></figure>
</li>
<li><p>循环处理所有的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Annotation paramAnn : paramAnns) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据判断找到对应的注解，我当前这个方法有一个参数所POJO，它有一个注解<code>@ModelAttribute(&quot;user&quot;)</code>。它会根据对应注解进行对应操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (RequestParam.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (RequestHeader.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (RequestBody.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (CookieValue.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (PathVariable.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ModelAttribute.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Value.class.isInstance(paramAnn)) &#123;...&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (paramAnn.annotationType().getSimpleName().startsWith(<span class="string">&quot;Valid&quot;</span>)) &#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断是不是有重复注解，如果有那么抛出异常。在这里证明，在SpringMVC中注解只能使用一个，并且只能使用上一步标出来的那些注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (annotationsFound &gt; <span class="number">1</span>) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Handler parameter annotations are exclusive choices - &quot;</span> +</span><br><span class="line">         <span class="string">&quot;do not specify more than one such annotation on the same parameter: &quot;</span> + handlerMethod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果自定义类型没有注解的情况下处理流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (annotationsFound == <span class="number">0</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>检查是否为原生API，如果是就根据API赋值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">argValue</span> <span class="operator">=</span> resolveCommonArgument(methodParam, webRequest);</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查参数是否为Model类型，如果是就直接吧<code>implicitModel</code>丢过去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; paramType = methodParam.getParameterType();</span><br><span class="line"><span class="keyword">if</span> (Model.class.isAssignableFrom(paramType) || Map.class.isAssignableFrom(paramType)) &#123;</span><br><span class="line">   <span class="keyword">if</span> (!paramType.isAssignableFrom(implicitModel.getClass())) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Argument [&quot;</span> + paramType.getSimpleName() + <span class="string">&quot;] is of type &quot;</span> +</span><br><span class="line">            <span class="string">&quot;Model or Map but is not assignable from the actual model. You may need to switch &quot;</span> +</span><br><span class="line">            <span class="string">&quot;newer MVC infrastructure classes to use this argument.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   args[i] = implicitModel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它类型不认识，不管…</p>
</li>
<li><p>判断如果是基本数据类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (BeanUtils.isSimpleProperty(paramType)) &#123;</span><br><span class="line">  paramName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>以上其它都不是，就把<code>attrName</code>初始化为空字符串</p>
</li>
</ul>
</li>
<li><p>这些不管</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (paramName != <span class="literal">null</span>) &#123;</span><br><span class="line">   args[i] = resolveRequestParam(paramName, required, defaultValue, methodParam, webRequest, handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (headerName != <span class="literal">null</span>) &#123;</span><br><span class="line">   args[i] = resolveRequestHeader(headerName, required, defaultValue, methodParam, webRequest, handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (requestBodyFound) &#123;</span><br><span class="line">   args[i] = resolveRequestBody(methodParam, webRequest, handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cookieName != <span class="literal">null</span>) &#123;</span><br><span class="line">   args[i] = resolveCookieValue(cookieName, required, defaultValue, methodParam, webRequest, handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pathVarName != <span class="literal">null</span>) &#123;</span><br><span class="line">   args[i] = resolvePathVariable(pathVarName, methodParam, webRequest, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析POJO参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (attrName != <span class="literal">null</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>确定自定义类型参数的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> WebDataBinder <span class="title function_">resolveModelAttribute</span><span class="params">(String attrName, MethodParameter methodParam,</span></span><br><span class="line"><span class="params">      ExtendedModelMap implicitModel, NativeWebRequest webRequest, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Bind request parameter onto object...</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> attrName;</span><br><span class="line">  <span class="comment">// 如果指定注解的value值为空，那么就获取参数名给到attrName</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(name)) &#123;</span><br><span class="line">      name = Conventions.getVariableNameForParameter(methodParam);</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment">// 获取参数类型</span></span><br><span class="line">   Class&lt;?&gt; paramType = methodParam.getParameterType();</span><br><span class="line">  <span class="comment">// 目标对象的值</span></span><br><span class="line">   Object bindObject;</span><br><span class="line">  <span class="comment">// 判断implicitModel中是否有这个属性，如果有就直接赋值</span></span><br><span class="line">   <span class="keyword">if</span> (implicitModel.containsKey(name)) &#123;</span><br><span class="line">      bindObject = implicitModel.get(name);</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment">//在session中获取对应的value，并且value类型要一致</span></span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.methodResolver.isSessionAttribute(name, paramType)) &#123;</span><br><span class="line">      bindObject = <span class="built_in">this</span>.sessionAttributeStore.retrieveAttribute(webRequest, name);</span><br><span class="line">      <span class="keyword">if</span> (bindObject == <span class="literal">null</span>) &#123;</span><br><span class="line">         raiseSessionRequiredException(<span class="string">&quot;Session attribute &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; required - not found in session&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// 如果以上几步都无法确定值，那么就使用反射创建一个对象</span></span><br><span class="line">      bindObject = BeanUtils.instantiateClass(paramType);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> createBinder(webRequest, bindObject, name);</span><br><span class="line">   initBinder(handler, name, binder, webRequest);</span><br><span class="line">   <span class="keyword">return</span> binder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>开始通过反射调用目标方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handlerMethodToInvoke.invoke(handler, args);</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>如果是自定义类型，那么赋值时只有两种结果，要么根据指定注解的value找，要么是空串</p>
</blockquote>
</li>
</ul>
<h2 id="视图和视图解析器"><a href="#视图和视图解析器" class="headerlink" title="视图和视图解析器"></a>视图和视图解析器</h2><h3 id="视图解析器-1"><a href="#视图解析器-1" class="headerlink" title="视图解析器"></a>视图解析器</h3><ul>
<li>请求处理方法执行后，最终返回一个<code>ModelAndView</code>对象。对于那些放回String、View或者ModelMap等类型的处理方法，SpringMVC也会在内部将他们装配成一个<code>ModelAndView</code>对象，它包含了逻辑名和模型对象的视图。</li>
<li>SpringMVC借助视图解析器（ViewResolver）得到最终的视图对象（View），最终的视图可以是JSP，也可能是Excel、JFreeChart等各种表现形式的视图</li>
<li>对于最终究竟采用哪种视图对象对模型数据进行渲染，处理器并不关心。处理器工作重点聚焦在生产模型数据的工作上，从而实现MVC的充分解耦。</li>
</ul>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><ul>
<li>视图的作用是渲染模型数据，将模型里的数据以某种形式呈现给客户。</li>
<li>为了实现视图模型和具体实现技术的解耦，Spring定义了一个高度抽象的View接口<code>org.springframework.web.servlet.View</code></li>
<li>视图对象由视图解析器负责实例化。由于视图是无状态的，所以他们不会有线程安全问题。</li>
</ul>
<p><img src="http://qiniu-note-image.ctong.top/note/images/%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%86%E5%9B%BE%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="常用的视图实现类"></p>
<h3 id="转发-1"><a href="#转发-1" class="headerlink" title="转发"></a>转发</h3><p>使用<code>forward</code>将当前请求转发到一个指定的页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/view_resolver&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewResolverController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">view</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/WEB-INF/pages/view_resolver/index.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/view_resolver</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>JSESSIONID=839F1BA4F614AEE5B2758EE57FCF0283; Path=/; HttpOnly</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-Hans-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1210</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 03 Aug 2021 07:55:28 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<p>使用<code>forward</code>前缀的转发不会由我们配置的视图解析器拼接字符串</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>使用<code>redirect</code>将一个请求重定向到另一个页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/view_resolver&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewResolverController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/redirect_page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">redirectPage</span><span class="params">()</span> &#123;</span><br><span class="line">        LogUtils.info(<span class="string">&quot;当前是/view_resolver/redirect_page&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;view_resolver/redirectPage&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/redirect&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRedirect</span><span class="params">()</span> &#123;</span><br><span class="line">        LogUtils.info(<span class="string">&quot;当前是/view_resolver/redirect， 准备重定向...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/view_resolver/redirect_page&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/view_resolver/redirect</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Language</span><span class="punctuation">: </span>zh-Hans-CN</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1214</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 03 Aug 2021 08:49:00 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前是/view_resolver/redirect， 准备重定向...</span><br><span class="line">当前是/view_resolver/redirect_page</span><br></pre></td></tr></table></figure>

<p><code>/</code>代表从当前项目下开始</p>
<blockquote>
<p>有前缀的转发和重定向操作视图解析器就不会拼接配置的字符串</p>
</blockquote>
<h3 id="视图解析流程"><a href="#视图解析流程" class="headerlink" title="视图解析流程"></a>视图解析流程</h3><ol>
<li>方法执行后的返回值会作为页面地址参考，转发或重定向到页面</li>
<li>在配置了视图解析器的情况下可能会进行页面地址的拼接</li>
</ol>
<p>略过其他，直接定位到<code>org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter#invokeHandlerMethod</code>。</p>
<ul>
<li><p>在目标方法执行完后拿到返回值<code>redirect:/view_resolver/redirect_page</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> methodInvoker.invokeHandlerMethod(handlerMethod, handler, webRequest, implicitModel);</span><br></pre></td></tr></table></figure>
</li>
<li><p>无论返回值是什么，都会包装成为一个<code>ModelAndView</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> methodInvoker.getModelAndView(handlerMethod, handler.getClass(), result, implicitModel, webRequest);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>invokeHandlerMethod</code>这个方法执行完后直接回到<code>org.springframework.web.servlet.DispatcherServlet#doDispatch</code></p>
<ul>
<li><p>拿到包装好的ModelAndView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>
</li>
<li><p>处理<code>ModelAndView</code>。<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果之前有什么错误，这里可以处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">      logger.debug(<span class="string">&quot;ModelAndViewDefiningException encountered&quot;</span>, exception);</span><br><span class="line">      mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> (mappedHandler != <span class="literal">null</span> ? mappedHandler.getHandler() : <span class="literal">null</span>);</span><br><span class="line">      mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">      errorView = (mv != <span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果没有什么错误就可以渲染页面，就看这个方法，其它不看，<strong>Step Into</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render(mv, request, response);</span><br></pre></td></tr></table></figure>
</li>
<li><p>声明一个空的<code>View</code>对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">View view;</span><br></pre></td></tr></table></figure>

<p><code>View</code>与<code>ViewResolver</code>的关系： <code>ViewResolver</code>是一个接口，它里面只有一个方法 &#x3D;&#x3D;&gt; </p>
<p><code>View resolveViewName(String viewName, Locale locale) throws Exception;</code></p>
</li>
<li><p>如果还没有解析视图，那么就通过视图名称去解析它。<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view = resolveViewName(mv.getViewName(), mv.getModelInternal(), locale, request);</span><br></pre></td></tr></table></figure>
</li>
<li><p>我在配置文件中有配置到一个视图解析器，所以SpringMVC在启动的时候不会帮我们创建视图解析器。所以这里只获取到一个视图解析器。拿到视图解析器后，通过视图解析器来解析视图，解析失败时返回null。<strong>Step Out</strong>出去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (ViewResolver viewResolver : <span class="built_in">this</span>.viewResolvers) &#123;</span><br><span class="line">  <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> viewResolver.resolveViewName(viewName, locale);</span><br><span class="line">  <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果成功拿到一个视图解析器，那么就调用这个视图解析器的<code>render</code>方法.<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.render(mv.getModelInternal(), request, response);</span><br></pre></td></tr></table></figure>
</li>
<li><p>不认识忽略….在<code>render</code>方法的最后一步进行渲染<strong>Step Into</strong>进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderMergedOutputModel(mergedModel, request, response);</span><br></pre></td></tr></table></figure>
</li>
<li><p>不认识….忽略</p>
</li>
<li><p>将Model中的所有属性暴露到request。实际上就是将所有的Map中的项目设置到request。<code>request.sertAttributre(Map.Key, Map.Value)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Expose the model object as request attributes.</span></span><br><span class="line">exposeModelAsRequestAttributes(model, requestToExpose);</span><br></pre></td></tr></table></figure>
</li>
<li><p>确定转发的路径，因为它是根据forward前缀给我们new了<code>InternalResourceView</code>。这是一个<strong>转发器</strong>？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dispatcherPath</span> <span class="operator">=</span> prepareForRendering(requestToExpose, response);</span><br></pre></td></tr></table></figure>
</li>
<li><p>转发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rd.forward(requestToExpose, response);</span><br></pre></td></tr></table></figure>
</li>
<li><p>完了…</p>
</li>
</ul>
<blockquote>
<p>视图解析器只是为了得到视图对象。视图对象才能真正的转发或重定向到页面视图对象才能真正的渲染视图</p>
</blockquote>
<h3 id="自定义视图和视图解析器"><a href="#自定义视图和视图解析器" class="headerlink" title="自定义视图和视图解析器"></a>自定义视图和视图解析器</h3><p><a target="_blank" rel="noopener" href="https://github.com/YouChuantong/spring_learn_demo/tree/main/CustomViewAndViewResolver">源码到我GitHub上下载</a></p>
<p>在SpringMVC中，是通过视图解析器找到对应视图，最后是视图将数据输出。无论是jsp页面还是json数据，都是如此。所以第一步需要先写一个数据我们自己的视图解析器。</p>
<p>既然有<code>forward</code>前缀，那么我搞一个能<code>clover:</code>前缀的视图解析器。解析器需要实现<code>org.springframework.web.servlet.ViewResolver</code>接口并把它注册到容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomViewResolver</span> <span class="keyword">implements</span> <span class="title class_">ViewResolver</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 视图名称前缀 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VIEW_NAME_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;clover:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 空字符 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EMPTY_STRING</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 日志记录 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">transient</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(MyCustomViewResolver.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> View <span class="title function_">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;resolveViewName执行了...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (viewName.startsWith(VIEW_NAME_PREFIX)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> viewName.replaceFirst(VIEW_NAME_PREFIX, EMPTY_STRING);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyCustomView</span>(uri);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>VIEW_NAME_PREFIX</code>属性就是我们的规则，通过判断控制器返回的字符串前缀是否是<code>clover:</code></p>
<p>。如果不是那么返回null，springmvc会继续找对应的视图解析器。解析成功之后将前缀截掉就行了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> viewName.replaceFirst(VIEW_NAME_PREFIX, EMPTY_STRING);</span><br></pre></td></tr></table></figure>

<p>符合我们定的规则，直接<code>new</code> 一个自定义的视图回去。接下来需要定义我们的视图。视图不需要让容器管理。视图需要实现<code>org.springframework.web.servlet.View</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomView</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>, View &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8278828333781661446L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 视图名称 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String VIEW_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCustomView</span><span class="params">(String viewName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.VIEW_NAME = viewName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 Content-Type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContentType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> request.getContentType();</span><br><span class="line">        System.out.println(contentType);</span><br><span class="line">        <span class="keyword">return</span> contentType == <span class="literal">null</span> ? MediaType.APPLICATION_JSON_VALUE + <span class="string">&quot;;charset=utf-8;&quot;</span> : contentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 渲染视图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model BindingAwareModelMap对象「域对象」</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request request 信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response response 信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.request = request;</span><br><span class="line">        <span class="built_in">this</span>.response = response;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="built_in">this</span>.response.getWriter()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.response.setContentType(getContentType());</span><br><span class="line">            writer.println(User.init());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(e.getMessage(), e.getCause());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个无参构造用来接收、保存视图名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">MyCustomView</span><span class="params">(String viewName)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.VIEW_NAME = viewName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出就行了，不管这么多</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writer.println(User.init());</span><br></pre></td></tr></table></figure>



<h2 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h2><p>页面提交的所有数据都是字符串，页面提交过来的数据必然牵扯到以下操作：</p>
<ol>
<li>数据绑定期间的数据类型转换<br> <code>String --&gt; Integer 或者String --&gt; Boolean</code></li>
<li>数据绑定期间的数据格式化问题，比如日期转换<br> <code>String=2017-12-15 ----&gt;&gt; Date=2017/12/15｜2017.12.15</code></li>
<li>数据校验<br> 前端提交的数据必须是合法的。所以前端不但需要校验，重要数据后端校验也是必须的</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> User data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setAge(<span class="number">19</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Clover&quot;</span>);</span><br><span class="line">        user.setSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">        user.setBirth(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        data = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7826062904698679590L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止存在一个或多个有参构造器时反射通过无参构造起实例化发生异常</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;&#123;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;\&quot;name\&quot;:\&quot;&quot;</span>).append(name).append(<span class="string">&#x27;\&quot;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;,\&quot;sex\&quot;:\&quot;&quot;</span>).append(sex).append(<span class="string">&#x27;\&quot;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;,\&quot;age\&quot;:&quot;</span>).append(age);</span><br><span class="line">        sb.append(<span class="string">&quot;,\&quot;birth\&quot;:\&quot;&quot;</span>).append(birth).append(<span class="string">&#x27;\&quot;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBirth</span><span class="params">(Date birth)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.birth = birth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#123;&#123;url&#125;&#125;/user/getUser?age=19&amp;name=clover&amp;birth=2020-08-05 11:03</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyDataController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getUser&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> user.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>debug到这个方法中<code>org.springframework.web.method.annotation.ModelAttributeMethodProcessor#resolveArgument</code>。</p>
<ul>
<li><p>创建数据绑定器，绑定参数、类型转换、数据、数据格式化、校验等操作都是这个绑定器提供的服务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(request, attribute, name);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>ConversionService</code>：负责数据类型的转换以及格式化功能，处理不同类型，使用的是不同的Converter。默认有以下这么多个converter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&quot;java.lang.Number -&gt; java.lang.Number : org.springframework.core.convert.support.NumberToNumberConverterFactory@6fc796e8&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.lang.Number : org.springframework.core.convert.support.StringToNumberConverterFactory@61006560&quot;</span><br><span class="line">&quot;java.lang.Number -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@653ffd98&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.lang.Character : org.springframework.core.convert.support.StringToCharacterConverter@203d6f5b&quot;</span><br><span class="line">&quot;java.lang.Character -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@731edd62&quot;</span><br><span class="line">&quot;java.lang.Number -&gt; java.lang.Character : org.springframework.core.convert.support.NumberToCharacterConverter@11d78d04&quot;</span><br><span class="line">&quot;java.lang.Character -&gt; java.lang.Number : org.springframework.core.convert.support.CharacterToNumberFactory@b1e619b&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.lang.Boolean : org.springframework.core.convert.support.StringToBooleanConverter@40129014&quot;</span><br><span class="line">&quot;java.lang.Boolean -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@45e2a0b9&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.lang.Enum : org.springframework.core.convert.support.StringToEnumConverterFactory@68f0baac&quot;</span><br><span class="line">&quot;java.lang.Enum -&gt; java.lang.String : org.springframework.core.convert.support.EnumToStringConverter@101a0c90&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.util.Locale : org.springframework.core.convert.support.StringToLocaleConverter@445cacb7&quot;</span><br><span class="line">&quot;java.util.Locale -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@14eb3bed&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.util.Properties : org.springframework.core.convert.support.StringToPropertiesConverter@79a3d606&quot;</span><br><span class="line">&quot;java.util.Properties -&gt; java.lang.String : org.springframework.core.convert.support.PropertiesToStringConverter@391d3b2e&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.util.UUID : org.springframework.core.convert.support.StringToUUIDConverter@180511ae&quot;</span><br><span class="line">&quot;java.util.UUID -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@55fc7510&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ArrayToCollectionConverter@32089a4f&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.CollectionToArrayConverter@621c136b&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ArrayToArrayConverter@52a4e6e7&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.CollectionToCollectionConverter@64c65d56&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.MapToMapConverter@126a7963&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ArrayToStringConverter@10efa70e&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.StringToArrayConverter@6589f82a&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ArrayToObjectConverter@33733520&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ObjectToArrayConverter@7213e34c&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.CollectionToStringConverter@1f29edd7&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.StringToCollectionConverter@354b1eb0&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.CollectionToObjectConverter@1fbbe70c&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ObjectToCollectionConverter@725f7e34&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ByteBufferConverter@22c862fd&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.ByteBufferConverter@22c862fd&quot;</span><br><span class="line">&quot;java.util.TimeZone -&gt; java.time.ZoneId : org.springframework.core.convert.support.TimeZoneToZoneIdConverter@4f9b568a&quot;</span><br><span class="line">&quot;java.time.ZoneId -&gt; java.util.TimeZone : org.springframework.core.convert.support.ZoneIdToTimeZoneConverter@f585bf2&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.IdToEntityConverter@67f2af3,org.springframework.core.convert.support.ObjectToObjectConverter@67416f4b&quot;</span><br><span class="line">&quot;org.springframework.core.convert.support.FallbackObjectToStringConverter@72fb4a2f&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.lang.Double -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Double: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.lang.Float -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Float: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.lang.Short -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Short: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.math.BigDecimal -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.math.BigDecimal: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.math.BigInteger -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.math.BigInteger: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.NumberFormat java.lang.Integer -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Integer: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.lang.Long -&gt; java.lang.String: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe,@org.springframework.format.annotation.NumberFormat java.lang.Long -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.lang.Long: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe,java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Long: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@3fb11849&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.LocalDate -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.LocalDate -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@4331c15&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalDate: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.LocalDate: org.springframework.format.datetime.standard.TemporalAccessorParser@33f73f8a&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.LocalTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.LocalTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@474a957f&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.LocalTime: org.springframework.format.datetime.standard.TemporalAccessorParser@67574179&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.LocalDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.LocalDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@7b182a32&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.LocalDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@711951b4&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.ZonedDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.ZonedDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@626bc385&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.ZonedDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.ZonedDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@3fea1a38&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.OffsetDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.OffsetDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@599fe4d&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.OffsetDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.OffsetDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@3e368bbb&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.time.OffsetTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.time.OffsetTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@27d0013&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.OffsetTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@2cb1819e,java.lang.String -&gt; java.time.OffsetTime: org.springframework.format.datetime.standard.TemporalAccessorParser@6da9f1be&quot;</span><br><span class="line">&quot;java.time.Instant -&gt; java.lang.String : org.springframework.format.datetime.standard.InstantFormatter@278801d0&quot;</span><br><span class="line">&quot;java.lang.String -&gt; java.time.Instant: org.springframework.format.datetime.standard.InstantFormatter@278801d0&quot;</span><br><span class="line">&quot;java.util.Date -&gt; java.lang.Long : org.springframework.format.datetime.DateFormatterRegistrar$DateToLongConverter@2de93dc9&quot;</span><br><span class="line">&quot;java.util.Date -&gt; java.util.Calendar : org.springframework.format.datetime.DateFormatterRegistrar$DateToCalendarConverter@47feddff&quot;</span><br><span class="line">&quot;java.util.Calendar -&gt; java.util.Date : org.springframework.format.datetime.DateFormatterRegistrar$CalendarToDateConverter@65f8f0bf&quot;</span><br><span class="line">&quot;java.util.Calendar -&gt; java.lang.Long : org.springframework.format.datetime.DateFormatterRegistrar$CalendarToLongConverter@219fb51&quot;</span><br><span class="line">&quot;java.lang.Long -&gt; java.util.Date : org.springframework.format.datetime.DateFormatterRegistrar$LongToDateConverter@667a89ae&quot;</span><br><span class="line">&quot;java.lang.Long -&gt; java.util.Calendar : org.springframework.format.datetime.DateFormatterRegistrar$LongToCalendarConverter@57dab1bb&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.util.Date -&gt; java.lang.String: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.util.Date: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe&quot;</span><br><span class="line">&quot;@org.springframework.format.annotation.DateTimeFormat java.util.Calendar -&gt; java.lang.String: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe&quot;</span><br><span class="line">&quot;java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.util.Calendar: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@40e685fe&quot;</span><br></pre></td></tr></table></figure>


</li>
<li><p><code>validators</code>：是数据校验器默认情况下是不会有数据校验功能，所以当前这里是0</p>
</li>
<li><p><code>bindingResult</code>：负责保存以及解析数据绑定期间数据校验产生的错误</p>
</li>
</ul>
</li>
<li><p>使用绑定器对目标对象就行处理「入参」</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bindRequestParameters(binder, request);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<ul>
<li>SpringMVC将ServletRequest对象及目标方法的入参实例传给<code>WebDataBinderFactory</code>实例以创建DataBinder实例对象</li>
<li>DataBinder调用装配在SpringMVC上下文中的<code>ConversionService</code>组件进行数据类型转换、数据格式化工作。将Servlet中的请求信息填充到入参对象中。</li>
<li>调用<code>Validator</code>组件对已经绑定了请求消息的入参对象进行数据合法性校验，并最终生成数据绑定结果<code>BindingData</code>对象</li>
<li>SpringMVC抽取<code>BindingResult</code>中的入参对象和校验错误对象，将它们赋给处理方法的响应入参。</li>
</ul>
<h3 id="自定义类型转换"><a href="#自定义类型转换" class="headerlink" title="自定义类型转换"></a>自定义类型转换</h3><p><a target="_blank" rel="noopener" href="https://github.com/YouChuantong/spring_learn_demo/tree/main/CustomConverter">源码下载地址</a></p>
<p>正常情况下，SpringMVC的默认入参是根据参数名到请求中去匹配，匹配上了就赋值。那么如果前端发了自定义格式<code>user=clover-19-sex-2020/08/05</code>，SpringMVC是无法解析的。这时需要自定义一个这种数据的类型转换器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyDataController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getUser&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(<span class="meta">@RequestParam(&quot;user&quot;)</span> User user)</span> &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> user.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="数据格式化"><a href="#数据格式化" class="headerlink" title="数据格式化"></a>数据格式化</h4><ul>
<li>对属性对象的输入输出进行格式化，从其本质上讲依然属于“类型转换”的范畴。</li>
<li>Spring在格式化模块中定义了一个实现<code>ConventionService</code>接口的<code>FormattingConvertionService</code>实现类。该实现类扩展了<code>GenericConvertionService</code>，因此它既具有类型转换的功能，又具有格式化的功能。</li>
<li><code>FormattingConversionService</code>拥有一个<code>FormattingConversionServiceFactoryBean</code>工厂类，后者用于在Spring上下文中构造前者。</li>
</ul>
<h3 id="实现Converter"><a href="#实现Converter" class="headerlink" title="实现Converter"></a>实现Converter</h3><p>需要实现<code>org.springframework.core.convert.converter.Converter</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToUserConverter</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>, Converter&lt;String, User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">5119628925082740825L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义类型转换器，String =====&gt;&gt; User。数据格式：clover-19-男-2021/08/05</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source 参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(source)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (!source.contains(<span class="string">&quot;-&quot;</span>)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// 通过&quot;-&quot;分割</span></span><br><span class="line">            String[] split = source.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line">            <span class="type">Short</span> <span class="variable">age</span> <span class="operator">=</span> Short.parseShort(split[<span class="number">1</span>]);</span><br><span class="line">            <span class="type">Character</span> <span class="variable">sex</span> <span class="operator">=</span> split[<span class="number">2</span>].toCharArray()[<span class="number">0</span>];</span><br><span class="line">            <span class="type">Date</span> <span class="variable">da</span> <span class="operator">=</span> sdf.parse(split[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">            user.setUserName(split[<span class="number">0</span>]);</span><br><span class="line">            user.setAge(age);</span><br><span class="line">            user.setBirthday(da);</span><br><span class="line">            user.setSex(sex);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Converter是ConvertionService中的组件，Converter写好后，还需要将它注册到ConventionService。</p>
<p>那么如何注册到<code>ConventionService</code>呢</p>
<ul>
<li><code>ConversionService</code>是Spring类型转换体系的核心接口</li>
<li>可以利用<code>ConversionServiceFactoryBean</code>在Spring的IOC容器中定义一个<code>ConversionService</code>。Spring将自动识别出IOC容器中的<code>ConversionService</code>。并在Bean属性配置及SpringMVC处理方法入参绑定等场合使用它进行数据的转换。</li>
<li>可通过<code>ConversionServiceFactoryBean</code>的<code>converters</code>属性注册自定义的类型转换器。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  conversion-service告诉SpringMVC使用我们自己配置的类型转换组件  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;top.ctong.bean.component.converter.StringToUserConverter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">&#123;&#123;url&#125;&#125;/user/getUser?user=clover-19-男-2021/08/05</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;clover&quot;</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;男&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h2 id="关于mvc-annotation-driven"><a href="#关于mvc-annotation-driven" class="headerlink" title="关于mvc:annotation-driven"></a>关于mvc:annotation-driven</h2><ul>
<li><code>&lt;mvc:annotation-driven&gt;</code>会自动注册<code>RequestMappingHandlerMapping</code>、<code>RequestMappingHandlerAdapter</code>和<code>ExceptionHandlerExceptionResolver</code>三个bean</li>
<li>还将提供以下支持<ol>
<li>支持使用<code>ConversionService</code>实例对表单参数进行类型转换</li>
<li>支持使用<code>@NumberFormatAnnotation</code>、<code>@DateTimeFormat</code>注解完成数据类型的格式化。</li>
<li>支持使用<code>@Valid</code>注解对JavaBean实例进行JSR303验证</li>
<li>支持使用<code>@RequestBody</code>和<code>@ResponseBody</code>注解</li>
</ol>
</li>
</ul>
<p>在Spring中，有一个<code>org.springframework.beans.factory.xml.BeanDefinitionParser</code>接口，它的作用就是用来解析Spring中各种标签。而<code>org.springframework.web.servlet.config.AnnotationDrivenBeanDefinitionParser</code> 是它众多实现类中的其中一个，专门用来解析<code>&lt;mvc:annotation-driven&gt;</code>标签。</p>
<p>这个类解析时给容器中添加了好多好多好多组件…</p>
<h3 id="静态资源无法访问原理"><a href="#静态资源无法访问原理" class="headerlink" title="静态资源无法访问原理"></a>静态资源无法访问原理</h3><p>在加上<code>&lt;mvc:annotation-driven&gt;</code>后，发现静态资源无法访问，动态资源没问题。这时再加上一个<code>&lt;mvc:default-servlet-handler/&gt;</code>就都可以访问。</p>
<p>原因是默认情况下都没配置的时候动态资源可以访问，静态资源不能访问。在<code>HandlerMappings</code>组件中，保存了所有的请求信息，通过请求路径可以找到谁能处理当前请求，所以动态资源可以访问。<br>在加上<code>&lt;mvc:default-servlet-handler/&gt;</code>后，静态资源可以访问，而动态资源不能访问。其根本原因是，默认情况下，SpringMVC使用的是<code>RequestMappingHandlerMapping</code>，它里面保存了所有的映射信息。而加上<code>&lt;mvc:default-servlet-handler/&gt;</code>后，在<code>HandlerMapping</code>组件注册了一个<code>SimpleUrlHandlerMapping</code>。在这个HandlerMapping中，映射路径为<code>/**</code>，并且当前请求全部交给Tomcat处理。<strong>但是</strong>，<code>RequestMappingHandlerMapping</code>不见了。</p>
<p><code>&lt;mvc:default-servlet-handler/&gt;</code>标签是由<code>org.springframework.web.servlet.config.DefaultServletHandlerBeanDefinitionParser</code>进行解析。在里面给容器中添加了<code>SimpleUrlHandlerMapping.class</code>。在<code>DispatcherServlet</code> 的<code>initHandlerMappings</code> 方法中，如果找到一个<code>HandlerMpping.class</code>类型的Bean，那么就不使用默认策略。由此可得出其原因。</p>
<p>刚刚说了，<code>&lt;mvc:annotation-driven&gt;</code>由<code>org.springframework.web.servlet.config.AnnotationDrivenBeanDefinitionParser</code> 解析，里面创建了好多好多好多组件…这好多组件中，<code>RequestMappingHandlerMapping</code>就是其中之一。</p>
<h2 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h2><p>只做前端的校验是不安全的，重要的数据必须在后端进行校验：</p>
<ol>
<li><p>可以将用户传过来的数据进行校验，如果校验失败可以转发到相应页面进行处理或返回错误代码。</p>
</li>
<li><p>SpringMVC可以根据JSR303来做数据校验</p>
<blockquote>
<p>JSR303是java为Bean数据合法性校验提供的标准框架，它已经包含在	JavaEE6.0中。<br>JSR303通过在Bean属性上标注类似于<code>@NotNull</code>、<code>@Max</code>等标准的注解执行校验规则，并通过标准的验证接口对Bean进行验证</p>
</blockquote>
<table>
<thead>
<tr>
<th>注解</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Nnull</td>
<td>被标注的元素必须为null</td>
</tr>
<tr>
<td>@NotNull</td>
<td>被标注的元素必须不为null</td>
</tr>
<tr>
<td>@AssertTrue</td>
<td>被标注的元素必须为true</td>
</tr>
<tr>
<td>@AssertFalse</td>
<td>被标注的元素必须为false</td>
</tr>
<tr>
<td>@Min(value)</td>
<td>被标注的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td>@Max(value)</td>
<td>被标注的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td>@DecimaiMin(value)</td>
<td>被标注的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td>@DecimaiMax(value)</td>
<td>被标注的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td>@Size(max, min)</td>
<td>被标注的元素大小必须在指定的范围内</td>
</tr>
<tr>
<td>@Digits(integer, fraction)</td>
<td>被标注的元素必须是一个数字，其值必须在可接受的范围内</td>
</tr>
<tr>
<td>@Past</td>
<td>被标注的元素必须是一个过去的日期</td>
</tr>
<tr>
<td>@Future</td>
<td>被标注的元素必须是在一个未来的日期</td>
</tr>
<tr>
<td>@Pattern(value)</td>
<td>被标注的元素必须符合指定的正则表达式</td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="hibernate-validator"><a href="#hibernate-validator" class="headerlink" title="hibernate-validator"></a>hibernate-validator</h3><p>使用hibernate实现的数据校验api。<a target="_blank" rel="noopener" href="http://hibernate.org/validator/releases/">下载地址：传送门</a></p>
<p>导入这些包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hibernate-validator-annotation-processor-5.0.3.Final.jar</span><br><span class="line">hibernate-validator-cdi-5.0.3.Final.jar</span><br><span class="line">hibernate-validator-5.0.3.Final.jar</span><br><span class="line">classmate-1.0.0.jar</span><br><span class="line">jboss-logging-3.1.1.GA.jar</span><br><span class="line">validation-api-1.1.0.Final.jar</span><br></pre></td></tr></table></figure>

<p>导入这些包之后就可以使用上面列出的注解，如果使用的tomcat是7.0以上，不需要导入<code>lib/required</code>文件夹中带有<code>el</code> 的jar包。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>只需要给javaBean的属性加上校验注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2000200405058799837L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 员工姓名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 年龄</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Min(18)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生日</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Past</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringMC封装对象的时候，使用<code>@Valid</code>告诉SpringMVC这个javaBean需要校验:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">testValidator</span><span class="params">(<span class="meta">@Valid</span> Employee employee)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>如果需要获取校验结果，那么在需要校验的参数后面<strong>紧跟</strong>一个<code>BindingResult</code>参数，这个参数封装了校验结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">testValidator</span><span class="params">(<span class="meta">@Valid</span> Employee employee, BindingResult result)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p><code>BindingResult</code>有几个比较常用的方法：</p>
<ul>
<li><code>hasErrors()</code> 检查验证结果是否有错误，如果有错误则返回<code>true</code>反之<code>false</code></li>
<li><code>getAllErrors()</code> 获取全部异常</li>
<li><code>getFieldErrors()</code>获取字段错误信息</li>
</ul>
<h2 id="SpringMVC响应JSON"><a href="#SpringMVC响应JSON" class="headerlink" title="SpringMVC响应JSON"></a>SpringMVC响应JSON</h2><p>导入这三个包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jackson-annotations-2.1.5.jar</span><br><span class="line">jackson-core-2.1.5.jar</span><br><span class="line">jackson-databind-2.1.5.jar</span><br></pre></td></tr></table></figure>

<p>完事之后在你需要返回JSON的控制器中加上<code>@ResponseBody</code>，表示返回值不使用视图解析器处理，而是使用返回值解析器进行处理。如果返回的是一个对象，那么由Jackson包将返回值自动转为json格式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hibernate-validator&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">testValidator</span><span class="params">(<span class="meta">@Valid</span> Employee employee, BindingResult result)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="JsonFormat"><a href="#JsonFormat" class="headerlink" title="JsonFormat"></a>JsonFormat</h3><p>在jackson中，除了能返回json外，他还提供了非常多的注解，jackson工作时使用对应处理器处理被这些注解标注的属性。而<code>JsonFormat</code>就是其中之一，具体可查看<code>com.fasterxml.jackson.annotation</code>包下的注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date birth;</span><br></pre></td></tr></table></figure>

<p> 返回结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;empName&quot;</span><span class="punctuation">:</span><span class="string">&quot;你好&quot;</span><span class="punctuation">,</span><span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;21312&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">1232</span><span class="punctuation">,</span><span class="attr">&quot;birth&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-08-15&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="ResponseBody"></a>ResponseBody</h2><p><code>@RequestBody</code>可以标注在类上，也可以标注在方法上。</p>
<ul>
<li>在类上：表示当前类中所有<code>RequestMapping</code>都使用返回值解析器的方式解析而不再使用视图解析器。</li>
<li>在方法上：表示当前<code>RequestMapping</code>使用返回值解析器的方式解析而不再使用视图解析器。</li>
</ul>
<p>它会把解析器处理好的数据放到响应体中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ResponseBody响应数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/response-body&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testResponseBody</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/validator/response-body</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>11</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 15 Aug 2021 01:11:44 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-ebnf"><span class="attribute">hello world</span></span></span><br></pre></td></tr></table></figure>





<h2 id="RequestBody"><a href="#RequestBody" class="headerlink" title="RequestBody"></a>RequestBody</h2><p><code>@RequestBody</code>用于获取一个请求的请求体（只有POST有请求体）</p>
<p>发送一个POST请求</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/validator/request-body</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;empName&quot;</span><span class="punctuation">:</span><span class="string">&quot;你好&quot;</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;21312&quot;</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">1232</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;birth&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-08-15&quot;</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过ResponseBody获取请求体</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/request-body&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">testRequestBody</span><span class="params">(<span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;employee: &#123;&#125;&quot;</span>, employee);</span><br><span class="line">    <span class="keyword">return</span> employee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  08-15 08:57:45 employee: Employee(empName=你好, email=21312, age=1232, birth=Sun Aug 15 08:00:00 CST 2021)  (EmployeeController.java:70)</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 15 Aug 2021 00:57:45 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">&quot;empName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你好&quot;</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;21312&quot;</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">1232</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">&quot;birth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-08-15&quot;</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>

<p>这种方式非常依赖<code>Content-Type</code>，如果你没告诉服务器你发送的是什么数据类型，那么服务器可能会出现异常。因为SpringMVC是根据请求头来匹配对应的解析器。</p>
<h2 id="HttpEntity"><a href="#HttpEntity" class="headerlink" title="HttpEntity"></a>HttpEntity</h2><p>可以获取请求中的大部分信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/test-http-entity&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHttpEntity</span><span class="params">(HttpEntity&lt;String&gt; httpEntity)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> httpEntity.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/validator/test-http-entity</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>185</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 15 Aug 2021 01:20:15 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-inform7">&lt;,&#123;user-agent=<span class="comment">[vscode-restclient]</span>, accept-encoding=<span class="comment">[gzip, deflate]</span>, cookie=<span class="comment">[JSESSIONID=7938CB3D5740911ECD4697D79118757B]</span>, host=<span class="comment">[localhost:8080]</span>, connection=<span class="comment">[close]</span>, content-length=<span class="comment">[0]</span>&#125;&gt;</span></span><br><span class="line"><span class="language-inform7"></span></span><br></pre></td></tr></table></figure>



<h2 id="ResponseEntity"><a href="#ResponseEntity" class="headerlink" title="ResponseEntity"></a>ResponseEntity</h2><p> <code>ResponseEntity</code>可以将返回数据放在响应体中，并且支持自定义响应头和状态码。如果返回值是<code>ResponseEntity</code>，那就不要加<code>@ResponseBody</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test-response-entity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">testResponseEntity</span><span class="params">()</span>&#123;</span><br><span class="line">    MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;hello man!&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(body, headers, HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/validator/test-response-entity</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain;charset=ISO-8859-1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>10</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 15 Aug 2021 01:32:48 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-erlang-repl">hello man!</span></span><br></pre></td></tr></table></figure>



<h2 id="SpringMVC文件下载"><a href="#SpringMVC文件下载" class="headerlink" title="SpringMVC文件下载"></a>SpringMVC文件下载</h2><p>主要是使用<code>ResponseEntity</code>定制响应头</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; downloadFile(HttpServletRequest request) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到项目真实路径</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getServletContext();</span><br><span class="line">    <span class="comment">// 找到下载文件</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;/WEB-INF/classes/a8154754ca508cf399952de76c60693f.jpg&quot;</span>);</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(realPath);</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">    fileInputStream.read(bytes);</span><br><span class="line">    fileInputStream.close();</span><br><span class="line">    MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    headers.set(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=a8154754ca508cf399952de76c60693f.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将文件流返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(bytes, headers, HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>导入依赖包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commons-io-2.0.jar</span><br><span class="line">commons-fileupload-1.2.1.jar</span><br></pre></td></tr></table></figure>

<p>导入依赖包后在配置文件中配置文件上传解析器（文件上传解析器是SpringMVC九大组件之一）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  文件上传解析器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    配置文件上传最大大小    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;1024 * 1024 * 20&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    配置默认字符编码    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在SpringMVC中，只需要有一个<code>MultipartFile</code>类型的参数，并且<code>Content-Type</code>是<code>multipart/form-data</code>就可以得到上传的图片。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;userName&quot;, required = false)</span> String userName,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;file&quot;, required = false)</span> MultipartFile file)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;userName: ====&gt;&gt;&gt; &#123;&#125;&quot;</span>, userName);</span><br><span class="line">    <span class="keyword">if</span> (file != <span class="literal">null</span>) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;fileName: =====&gt;&gt;&gt; &#123;&#125;&quot;</span>, file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/file/upload</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;userName&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">userName</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;美少女.jpg&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/jpeg</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">&lt; /Users/clover/Desktop/美少女.jpg</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>

<p>控制台打印：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO  08-15 17:02:34 userName: ====&gt;&gt;&gt; userName  (FileController.java:71) </span><br><span class="line">INFO  08-15 17:02:58 fileName: =====&gt;&gt;&gt; file  (FileController.java:73) </span><br></pre></td></tr></table></figure>

<p>如果需要保存上传的文件，只需要使用<code>MultipartFile</code>中提供的<code>transferTo()</code>方法就能快速保存文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/clover/Desktop/&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.jpg&quot;</span>));</span><br></pre></td></tr></table></figure>



<h3 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h3><p>只需要将<code>MultipartFile</code>参数声明为数组或者<code>List</code>即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(value = &quot;userName&quot;, required = false)</span> String userName,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;file&quot;, required = false)</span> MultipartFile[] files)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;userName: ====&gt;&gt;&gt; &#123;&#125;&quot;</span>, userName);</span><br><span class="line">    <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;fileName: =====&gt;&gt;&gt; &#123;&#125;&quot;</span>, file.getName());</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/clover/Desktop/&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.jpg&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:8080/springmvc_helloworld_war_exploded/file/upload</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line"></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span><br><span class="line"><span class="language-awk">Content-Disposition: form-data; name=<span class="string">&quot;userName&quot;</span></span></span><br><span class="line"><span class="language-awk"></span></span><br><span class="line"><span class="language-awk">userName</span></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span><br><span class="line"><span class="language-awk">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;0.jpg&quot;</span></span></span><br><span class="line"><span class="language-awk">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-awk"></span></span><br><span class="line"><span class="language-awk">&lt; <span class="regexp">/Users/</span>clover<span class="regexp">/Downloads/</span>f2215fb6a14e1c6742770c18b5166872.jpg</span></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span><br><span class="line"><span class="language-awk">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;1.jpg&quot;</span></span></span><br><span class="line"><span class="language-awk">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-awk"></span></span><br><span class="line"><span class="language-awk">&lt; <span class="regexp">/Users/</span>clover<span class="regexp">/Downloads/</span>a8154754ca508cf399952de76c60693f(<span class="number">1</span>).jpg</span></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span><br><span class="line"><span class="language-awk">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;2.jpg&quot;</span></span></span><br><span class="line"><span class="language-awk">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-awk"></span></span><br><span class="line"><span class="language-awk">&lt; <span class="regexp">/Users/</span>clover<span class="regexp">/Downloads/</span>wallpaper (<span class="number">1</span>).jpg</span></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span><br><span class="line"><span class="language-awk">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;3.jpg&quot;</span></span></span><br><span class="line"><span class="language-awk">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-awk"></span></span><br><span class="line"><span class="language-awk">&lt; <span class="regexp">/Users/</span>clover<span class="regexp">/Downloads/</span>wallpaper.jpg</span></span><br><span class="line"><span class="language-awk">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span></span><br><span class="line"><span class="language-awk"></span></span><br></pre></td></tr></table></figure>







<h2 id="HttpMessageConverter-内容协商"><a href="#HttpMessageConverter-内容协商" class="headerlink" title="HttpMessageConverter(内容协商)"></a>HttpMessageConverter(内容协商)</h2><blockquote>
<p>更详细的原理、用法在我博客SpringBoot学习笔记中有记录</p>
</blockquote>
<p><img src="http://qiniu-note-image.ctong.top/note/images/%E6%88%AA%E5%B1%8F2021-08-15%2015.52.22.png" alt="HttpMessageConverter工作原理"></p>
<ul>
<li><code>HttpMessageConverter&lt;T&gt;</code>： 是Spring3.0新添加的一个接口，<strong>负责将请求信息转换为一个对象（类型为T），将对象输出为响应信息</strong></li>
<li><code>HttpMessageConverter&lt;T&gt;</code>接口定义的方法：<ul>
<li><code>boolean canRead(Class&lt;?&gt; clazz, MediaType mediaType);</code>：指定转换器可以读取的对象类型，即转换器是否可将请求信息转换为clazz类型的对象，同时指定支持MIME类型（text&#x2F;html，application&#x2F;json等）</li>
<li><code>boolean canWrite(Class&lt;?&gt; clazz, MediaType mediaType);</code>：指定转换器是否可将clazz类型的对象写到响应流中，响应流支持的媒体类型在MediaType中定义。</li>
<li><code>List&lt;MediaType&gt; getSupportedMediaTypes();</code>：该转换器支持的媒体类型。</li>
<li><code>T read(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)throws IOException,HttpMessageNotReadableException;</code>：将请求信息流转换为T类型的对象。</li>
<li><code>void write(T t, MediaType contentType, HttpOutputMessage outputMessage)throws IOException,HttpMessageNotWritableException;</code>：将T类型的对象写到响应流中，同时指定相应的媒体类型为<code>contentType</code></li>
</ul>
</li>
<li>在加入Jackson 包后，有个叫<code>MappingJackson2HttpMessageConverter</code>的转换器被加入了<code>RequestMappingHandlerAdapter</code>的<code>HttpMessageConverter</code></li>
</ul>
<p>这东西其实就是用来做请求&#x2F;响应数据的格式转换的。</p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>SpringMVC提供了拦截器，它允许运行目标方法之前进行一些拦截工作，或者目标方法运行之后进行一些其他处理。</p>
<p>SpringMVC的拦截器是一个接口：<code>org.springframework.web.servlet.HandlerInterceptor</code>，它有三个方法</p>
<ul>
<li><code>preHandle</code> 在目标方法运行之前调用。它需要返回一个Boolean，他类似javaWeb过滤器的<code>chain.doFilter()</code>。<ul>
<li><code>true</code> 表示通过</li>
<li><code>false</code> 表示不通过</li>
</ul>
</li>
<li><code>postHandle</code> 在目标方法执行之后被调用。</li>
<li><code>afterCompletion</code>在请求全部执行完成之后被调用。</li>
</ul>
<h3 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h3><p>实现<code>HandlerInterceptor</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>, HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">3000412083847294171L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object o)</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o,</span></span><br><span class="line"><span class="params">            ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 无需实现</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse,</span></span><br><span class="line"><span class="params">            Object o, Exception e)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 无需实现</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringMVC配置文件中注册这个拦截器，并且配置这个拦截器的拦截规则。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  配置拦截器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    配置某个拦截器，默认拦截所有请求    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loginInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.ctong.springmvc.interceptor.LoginInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你需要定义拦截规则，那么还需要借助<code>&lt;mvc:interceptor&gt;</code>标签和<code>&lt;mvc:mapping&gt;</code>标签</p>
<ul>
<li><code>path</code> 指定拦截的路径</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--     定义拦截规则       --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/api&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loginInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.ctong.springmvc.interceptor.LoginInterceptor&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>若需要<strong>排除</strong>哪些路径，可以通过<code>&lt;mvc:exclude-mapping/&gt;</code>标签指定排除规则</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/static&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loginInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.ctong.springmvc.interceptor.LoginInterceptor&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><ul>
<li>SpringMVC通过<code>HandlerExceptionResolver</code> 处理程序的异常，包括Handler映射、数据绑定以及目标方法执行时发生的异常。</li>
<li>SpringMVC默认提供的<code>HandlerExceptionResolver</code>的实现类<ul>
<li><code>ExceptionHandlerExceptionResolver</code></li>
<li><code>ResponseStatusExceptionResolver</code></li>
<li><code>DefaultHandlerExceptionResolver</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>在SpringMVC处理异常源码中，它默认提供的那三个异常基本只能解决Spring&#x2F;SpringMVC出现的异常。解决不了的异常都抛给Tomcat</p>
</blockquote>
<h3 id="ExceptionHandler"><a href="#ExceptionHandler" class="headerlink" title="@ExceptionHandler"></a>@ExceptionHandler</h3><p>这个注解标注在<code>Controller</code>的某一个异常处理方法上，用于告诉SpringMVC这个方法专门处理<strong>这个类</strong>的异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerException</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个注解有一个属性</p>
<ul>
<li><code>Class&lt;? extends Throwable&gt;[] value()</code> 用于指定这个方法处理哪些异常信息。默认全部异常都能处理</li>
</ul>
<p>若需要获取异常信息，可以在写一个<code>Exception</code>类型的参数，SpringMVC会自动把异常信息传过来。<br>注意：<code>@ExceptionHandler</code>标注的方法参数可以随便写，但SpringMVC只认识<code>Exception</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;NullPointerException.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handlerException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要将异常信息返回到页面，可以返回一个<code>ModelAndView</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;NullPointerException.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">handlerException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">  <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;/error.jsp&quot;</span>);</span><br><span class="line">  mv.addObject(<span class="string">&quot;errmsg&quot;</span>,e.getMessage());</span><br><span class="line">  <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ControllerAdvice全局处理异常"><a href="#ControllerAdvice全局处理异常" class="headerlink" title="@ControllerAdvice全局处理异常"></a>@ControllerAdvice全局处理异常</h3><p>由于<code>@ExceptionHandler</code>在<code>Controller</code>中只能处理当前<code>Controller</code>中发生的异常，这种方式会导致代码无法复用，所以SpringMVC写了一个<code>ControllerAdvice</code>注解，专门处理异常的类。</p>
<p>标注了<code>ControllerAdvice</code>的类中所有标注了<code>@ExceptionHandler</code>的方法就能处理全局异常。</p>
<h3 id="ResponseStatus"><a href="#ResponseStatus" class="headerlink" title="@ResponseStatus"></a>@ResponseStatus</h3><p><code>@ResponseStatus</code>这个注解用于标注在自定义异常上，SpringMVC可以使用<code>ResponseStatusExceptionResolver</code>异常解析器解析它，它有两个属性：</p>
<ul>
<li><code>HttpStatus value();</code> 响应状态码，解析器会将这个状态码响应出去</li>
<li><code>String reason() default &quot;&quot;;</code>  错误原因</li>
</ul>
<h3 id="SimpleMappingExceptionHandle"><a href="#SimpleMappingExceptionHandle" class="headerlink" title="SimpleMappingExceptionHandle"></a>SimpleMappingExceptionHandle</h3><p>映射异常信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;simpleMappingExceptionHandle&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    exceptionMappings配置哪些异常去哪些页面，它是一个Properties    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- key：异常全类名，value：要去的页面 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.ArithmeticException&quot;</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在错误页面如果想要取错误信息，需要使用<code>$&#123;ex&#125;</code>，SimpleMappingExceptionResolver也提供了一个属性可以修改封装错误时异常信息用的Key。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;simpleMappingExceptionHandle&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;errmsg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="SpringMVC运行流程"><a href="#SpringMVC运行流程" class="headerlink" title="SpringMVC运行流程"></a>SpringMVC运行流程</h2><ul>
<li>前端控制器(DispatcherServlet)收到请求后会调用<code>doDispath</code>进行处理。</li>
<li>根据HandlerMapping中保存的请求映射信息找到处理器当前处理器的执行链，执行链中包含拦截器。</li>
<li>根据当前处理器找到他的HandlerAdapter(适配器)</li>
<li>执行拦截器<code>preHandle</code>方法</li>
<li>使用适配器执行目标方法并返回<code>ModelAndView</code><ul>
<li><code>ModelAttribute</code> 注解标注的方法先于目标方法执行</li>
<li>确定执行目标方法参数<ol>
<li>有注解</li>
<li>没有注解<ol>
<li>看是否是Model、Map等</li>
<li>如果是自定义类型<ol>
<li>从隐含模型中看有没有，如果有就从模型中取值</li>
<li>再看是否是<code>SessionAttribute</code>标注的属性，如果是就从Sessiong中拿，如果拿不到就抛异常</li>
<li>如果都不是，就利用反射创建对象</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ul>
</li>
<li>执行拦截器的<code>postHandle</code>方法</li>
<li>处理结果；（页面渲染流程）<ul>
<li>如果有异常就使用异常解析器处理异常。处理完了还会返回<code>ModelAndView</code></li>
<li>调用render进行页面渲染。<ol>
<li>视图解析器根据视图名得到试图对象</li>
<li>视图对象调用render方法完成渲染</li>
</ol>
</li>
<li>执行拦截器的<code>afterCompletion</code>方法</li>
</ul>
</li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">SpringMVC学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">导包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HelloWorld"><span class="toc-number">1.3.</span> <span class="toc-text">HelloWorld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">编写处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91"><span class="toc-number">1.3.2.</span> <span class="toc-text">转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">视图解析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestMapping"><span class="toc-number">1.4.</span> <span class="toc-text">@RequestMapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E6%B3%A8%E5%9C%A8%E7%B1%BB%E4%B8%8A"><span class="toc-number">1.4.1.</span> <span class="toc-text">标注在类上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">规定请求方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.3.</span> <span class="toc-text">规定请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">1.4.4.</span> <span class="toc-text">规定请求头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ant%E9%A3%8E%E6%A0%BC%E7%9A%84URL"><span class="toc-number">1.4.5.</span> <span class="toc-text">Ant风格的URL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PathVariable"><span class="toc-number">1.5.</span> <span class="toc-text">@PathVariable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REST"><span class="toc-number">1.6.</span> <span class="toc-text">REST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestParam"><span class="toc-number">1.7.1.</span> <span class="toc-text">@RequestParam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestHeader"><span class="toc-number">1.7.2.</span> <span class="toc-text">@RequestHeader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CookieValue"><span class="toc-number">1.7.3.</span> <span class="toc-text">@CookieValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJO%E5%8F%82%E6%95%B0"><span class="toc-number">1.7.4.</span> <span class="toc-text">POJO参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%94%9FAPI"><span class="toc-number">1.7.5.</span> <span class="toc-text">原生API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="toc-number">1.8.</span> <span class="toc-text">SpringMVC解决中文乱码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="toc-number">1.9.</span> <span class="toc-text">数据输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Map"><span class="toc-number">1.9.1.</span> <span class="toc-text">Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model"><span class="toc-number">1.9.2.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelMap"><span class="toc-number">1.9.3.</span> <span class="toc-text">ModelMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelAndView"><span class="toc-number">1.9.4.</span> <span class="toc-text">ModelAndView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionAttributes"><span class="toc-number">1.9.5.</span> <span class="toc-text">@SessionAttributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelAttribute"><span class="toc-number">1.9.6.</span> <span class="toc-text">@ModelAttribute</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DispatcherServlet-%E5%88%86%E6%9E%90"><span class="toc-number">1.10.</span> <span class="toc-text">DispatcherServlet 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%9B%BE"><span class="toc-number">1.10.1.</span> <span class="toc-text">继承图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%A7%E8%87%B4%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.10.2.</span> <span class="toc-text">请求大致处理流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringMVC%E4%B9%9D%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">1.10.3.</span> <span class="toc-text">SpringMVC九大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.10.4.</span> <span class="toc-text">执行目标方法源码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text">视图和视图解析器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8-1"><span class="toc-number">1.11.1.</span> <span class="toc-text">视图解析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.11.2.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91-1"><span class="toc-number">1.11.3.</span> <span class="toc-text">转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.11.4.</span> <span class="toc-text">重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.5.</span> <span class="toc-text">视图解析流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E5%92%8C%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.11.6.</span> <span class="toc-text">自定义视图和视图解析器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">1.12.</span> <span class="toc-text">数据绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.12.1.</span> <span class="toc-text">自定义类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">数据格式化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0Converter"><span class="toc-number">1.12.2.</span> <span class="toc-text">实现Converter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Emvc-annotation-driven"><span class="toc-number">1.13.</span> <span class="toc-text">关于mvc:annotation-driven</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.13.1.</span> <span class="toc-text">静态资源无法访问原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.14.</span> <span class="toc-text">数据校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hibernate-validator"><span class="toc-number">1.14.1.</span> <span class="toc-text">hibernate-validator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E5%93%8D%E5%BA%94JSON"><span class="toc-number">1.15.</span> <span class="toc-text">SpringMVC响应JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonFormat"><span class="toc-number">1.15.1.</span> <span class="toc-text">JsonFormat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResponseBody"><span class="toc-number">1.16.</span> <span class="toc-text">ResponseBody</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequestBody"><span class="toc-number">1.17.</span> <span class="toc-text">RequestBody</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpEntity"><span class="toc-number">1.18.</span> <span class="toc-text">HttpEntity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResponseEntity"><span class="toc-number">1.19.</span> <span class="toc-text">ResponseEntity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.20.</span> <span class="toc-text">SpringMVC文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.21.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.21.1.</span> <span class="toc-text">多文件上传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpMessageConverter-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">1.22.</span> <span class="toc-text">HttpMessageConverter(内容协商)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.23.</span> <span class="toc-text">拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.23.1.</span> <span class="toc-text">自定义拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.24.</span> <span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ExceptionHandler"><span class="toc-number">1.24.1.</span> <span class="toc-text">@ExceptionHandler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ControllerAdvice%E5%85%A8%E5%B1%80%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">1.24.2.</span> <span class="toc-text">@ControllerAdvice全局处理异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseStatus"><span class="toc-number">1.24.3.</span> <span class="toc-text">@ResponseStatus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleMappingExceptionHandle"><span class="toc-number">1.24.4.</span> <span class="toc-text">SimpleMappingExceptionHandle</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.25.</span> <span class="toc-text">SpringMVC运行流程</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&text=SpringMVC学习笔记"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&is_video=false&description=SpringMVC学习笔记"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpringMVC学习笔记&body=Check out this article: http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=SpringMVC学习笔记"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&name=SpringMVC学习笔记&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://www.ctong.top/2022/01/02/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&t=SpringMVC学习笔记"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    Clover You
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
